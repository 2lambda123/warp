WARP_TEST_GROUP_PREFIX="transpilation/run-cairo"
WARP_TEST_DIR="./tests/transpilation"
WARP_TEST_SUFFIX=".opcode.gold.cairo"

cairo_src_dir="./cairo-src"

test_case() {
    local opcode_file="$WARP_TEST_DIR/$1.opcode"
    local test_file="$WARP_TEST_DIR/$1$WARP_TEST_SUFFIX"
    printf "checking $test_file\n"
    local cairo_file="$opcode_file.gold.cairo"
    local gold_file="$opcode_file.gold.result"
    local temp_file="$opcode_file.temp.result"
    local compile_file="$opcode_file.temp.json"

    cairo-compile \
        --cairo_path $cairo_src_dir \
        "$cairo_file" > "$compile_file"
    cairo-run --program="$compile_file" \
        --layout=small --print_output > "$temp_file"
    diff "$temp_file" "$gold_file" \
         --ignore-trailing-space \
         --ignore-blank-lines \
         --new-file # treat absent files as empty

    rm "$temp_file"
    rm "$compile_file"
}
